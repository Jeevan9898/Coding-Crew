<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trending Stories - Artisan Echoes</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: 'Poppins', sans-serif; background: #faf3e0; margin: 0; }
    .header { background: #6d4c41; color: white; padding: 1rem; text-align: center; }
    .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
    .story-card {
      background: white; border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem;
      box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
    }
    .story-card h3 { margin: 0 0 0.5rem 0; color: #3e2723; }
    .story-card p { margin: 0.5rem 0; color: #5d4037; }
    .story-card .card-date { font-size: 0.85rem; color: #8d6e63; margin-bottom: 0.5rem; }
    .card-actions { display: flex; gap: 15px; margin-top: 10px; flex-wrap: wrap; }
    .card-actions button {
      background: #6d4c41; color: white; border: none; padding: 0.5rem 1rem;
      border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: 0.3s;
    }
    .card-actions button:hover { background: #4e342e; }
  </style>
</head>
<body>

  <div class="header">
    <h1>Trending Stories</h1>
  </div>

  <div class="container" id="trendingContainer">
    <!-- Stories will be dynamically inserted here -->
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const container = document.getElementById("trendingContainer");
      let posts = JSON.parse(localStorage.getItem("posts")) || [];

      // Load existing likes and comments from localStorage
      let likesData = JSON.parse(localStorage.getItem("likesData")) || {};
      let commentsData = JSON.parse(localStorage.getItem("commentsData")) || {};

      function renderPosts() {
        container.innerHTML = '';
        posts.reverse().forEach((post, index) => {
          const card = document.createElement("div");
          card.classList.add("story-card");
          card.innerHTML = `
            <h3>${post.title}</h3>
            <p>${post.content}</p>
            <div class="card-date">${post.date}</div>
            <div class="card-actions">
              <button class="like-btn" data-id="${index}">‚ù§Ô∏è Like (<span>${likesData[index] || 0}</span>)</button>
              <button class="comment-btn" data-id="${index}">üí¨ Comment (<span>${commentsData[index]?.length || 0}</span>)</button>
              <button class="save-btn" data-id="${index}">üìå Save</button>
              <button class="delete-btn" data-id="${index}" style="background:red;">üóëÔ∏è Delete</button>
            </div>
            <div class="comments-section" id="comments-${index}" style="margin-top:10px;"></div>
          `;
          container.appendChild(card);

          const commentsSection = card.querySelector(`#comments-${index}`);

          // Load saved comments
          if (commentsData[index]) {
            commentsData[index].forEach(comment => addCommentElement(commentsSection, comment, index));
          }
        });
      }

      renderPosts();

      // Event delegation for buttons
      container.addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if (!btn) return;

        const postId = parseInt(btn.dataset.id);

        // Like button
        if (btn.classList.contains("like-btn")) {
          likesData[postId] = (likesData[postId] || 0) + 1;
          localStorage.setItem("likesData", JSON.stringify(likesData));
          btn.querySelector("span").textContent = likesData[postId];
        }

        // Comment button
        if (btn.classList.contains("comment-btn")) {
          const commentText = prompt("Write your comment:");
          if (commentText) {
            commentsData[postId] = commentsData[postId] || [];
            commentsData[postId].push(commentText);
            localStorage.setItem("commentsData", JSON.stringify(commentsData));
            addCommentElement(document.getElementById(`comments-${postId}`), commentText, postId);
            btn.querySelector("span").textContent = commentsData[postId].length;
          }
        }

        // Save button
        if (btn.classList.contains("save-btn")) {
          let savedPosts = JSON.parse(localStorage.getItem("savedPosts")) || [];
          const post = posts[postId];
          if (!savedPosts.find(p => p.title === post.title && p.content === post.content)) {
            savedPosts.push(post);
            localStorage.setItem("savedPosts", JSON.stringify(savedPosts));
            alert("Post saved to your profile!");
          } else {
            alert("This post is already saved!");
          }
        }

        // Delete button
        if (btn.classList.contains("delete-btn")) {
          if (confirm("Are you sure you want to delete this story?")) {
            posts.splice(postId, 1);
            localStorage.setItem("posts", JSON.stringify(posts.reverse()));
            // Remove likes and comments for this post
            delete likesData[postId];
            delete commentsData[postId];
            localStorage.setItem("likesData", JSON.stringify(likesData));
            localStorage.setItem("commentsData", JSON.stringify(commentsData));
            renderPosts();
          }
        }
      });

      function addCommentElement(container, text, postId) {
        const commentDiv = document.createElement("div");
        commentDiv.style.display = "flex";
        commentDiv.style.justifyContent = "space-between";
        commentDiv.style.alignItems = "center";
        commentDiv.style.background = "#f5f5f5";
        commentDiv.style.padding = "5px 10px";
        commentDiv.style.marginTop = "5px";
        commentDiv.style.borderRadius = "6px";

        commentDiv.innerHTML = `
          <span>${text}</span>
          <button style="background:red;color:white;border:none;padding:2px 6px;border-radius:4px;cursor:pointer;">X</button>
        `;

        // Delete comment functionality
        commentDiv.querySelector("button").addEventListener("click", () => {
          commentsData[postId] = commentsData[postId].filter(c => c !== text);
          localStorage.setItem("commentsData", JSON.stringify(commentsData));
          commentDiv.remove();
          // Update comment count
          const commentBtn = document.querySelector(`.comment-btn[data-id="${postId}"]`);
          commentBtn.querySelector("span").textContent = commentsData[postId].length;
        });

        container.appendChild(commentDiv);
      }
    });
  </script>

</body>
</html>
